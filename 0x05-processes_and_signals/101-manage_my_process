#!/usr/bin/env bash
# This script will manages manage_my_process

is_process_running() {
    pgrep -f ./manage_my_process > /dev/null
    return $?
}

start_process() {
    ./manage_my_process &
    sleep 1
    is_process_running
    if [ $? -eq 0 ]; then
        sudo tee /var/run/my_process.pid <<< "$!"
        return 0
    else
        return 1
    fi
}

stop_process() {
    pkill -f ./manage_my_process
    sleep 1
    is_process_running
    if [ $? -ne 0 ]; then
        sudo rm -f /var/run/my_process.pid
    fi
}

case "$1" in
    start)
        is_process_running
        if [ $? -eq 0 ]; then
            echo 'manage_my_process is already running'
        else
            start_process
            if [ $? -eq 0 ]; then
                echo 'manage_my_process started'
            else
                echo 'Failed to start manage_my_process'
            fi
        fi
        ;;
    stop)
        is_process_running
        if [ $? -eq 0 ]; then
            stop_process
            echo 'manage_my_process stopped'
        else
            echo 'manage_my_process is not running'
        fi
        ;;
    restart)
        is_process_running
        if [ $? -eq 0 ]; then
            stop_process
        fi
        start_process
        if [ $? -eq 0 ]; then
            echo 'manage_my_process restarted'
        else
            echo 'Failed to restart manage_my_process'
        fi
        ;;
    *)
        echo 'Usage: manage_my_process {start|stop|restart}'
        exit 1
        ;;
esac

exit $?
